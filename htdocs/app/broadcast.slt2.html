#{ -- <pre>

	local month_names = { 'Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'}
	local weekdays = { 'Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'}
	local function isodate2htmldatetime(date)
		local t = parse_iso8601(date)
		local d = os.date('*t', t)
		return weekdays[d.wday] .. ", " .. d.day .. ". " .. month_names[d.month] .. " " .. os.date('%Y, %H:%M', t)
	end
	function isodate2htmltime(date)
		return os.date('%H:%M', parse_iso8601(date))
	end

	local function A(s)	-- escape for attribute
		return rec.escape_html_attribute( s )
	end
	local function T(s)	-- escape for text (\n -> <br />)
		return rec.escape_html_text( s )
	end

	local function DC_meta(met)
		local ret = {
			'    <!-- Dublin Core PBMI http://dcpapers.dublincore.org/pubs/article/view/749 -->',
			'    <!-- not: Ontology for Media Resources 1.0 http://www.w3.org/TR/mediaont-10/ -->',
			'    <!-- not: EBU http://tech.ebu.ch/lang/en/MetadataEbuCore -->',
		}
		for _,k in ipairs({
			'DC.scheme', 'DC.language', 'DC.title', 'DC.title.series', 'DC.title.episode',
			'DC.format.timestart', 'DC.format.timeend', 'DC.format.duration', 'DC.image',
			'DC.description', 'DC.publisher', 'DC.creator', 'DC.copyright', 'DC.source',
		}) do
			local row = {'    <meta content=\'', A(met[ rec.meta_key_to_lua(k) ]), '\' name=\'', k, '\'/>'}
			table.insert( ret, table.concat(row) )
		end
		return table.concat(ret,"\n")
	end

    local meta = broadcast.meta
-- </pre>
 }<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.1//EN" "http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd">
<html xml:lang='de' xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <meta content='text/html; charset=utf-8' http-equiv='content-type'/>
    <meta name="viewport" content="width=device-width"/>
    <link href='../../../app/style.css' rel='stylesheet' type='text/css'/>
    <title>#{= T(meta.DC_title) }</title>
    <link href='#{= A(meta.link_prev) }' rel='prev'/>
    <link href='#{= A(meta.link_next) }' rel='next'/>
    <link href='index.html' rel='parent'/>
    <link href='#{= A(meta.DC_source) }' rel='via'/>
    <!-- link href='../../../../../enclosures/app/schedule.lua?uri=referer' rel='edit-media'/ -->
#{= DC_meta(meta) }
  </head>
  <body id='broadcast'>
    <ul class='navigation'>
      <li id='link_now'><a href='../../../../../app/now.lua'>↻ aktuelle Sendung</a></li>
      <li id='link_parent'><a href='index.html' rel='parent'>↑ ganzer Tag</a></li>
      <li id='link_prev'><a href='#{= meta.link_prev }' rel='prev'>← vorige Sendung</a></li>
      <li id='link_next'><a href='#{= meta.link_next }' rel='next'>→ nächste Sendung</a></li>
    </ul>
    <h2 id='series'>#{= T(meta.DC_title_series) }</h2>
    <h1 id='title'>#{= T(meta.DC_title) }</h1>
    <h2 id='summary'>#{= T(meta.DC_title_episode) }</h2>
    <p class='via'><a href='#{= A(meta.DC_source) }' id='via' rel='via'>www.br.de</a></p>
    <p id='date'>
      <span id='dtstart' title='#{= A(meta.DC_format_timestart) }'>#{= isodate2htmldatetime(meta.DC_format_timestart) }</span>
       bis 
      <span id='dtend' title='#{= A(meta.DC_format_timeend) }'>#{= isodate2htmltime(meta.DC_format_timeend) }</span>
    </p>
    <p class='image'><img alt='Bild zur Sendung' id='image' src='#{= A(meta.DC_image) }'/></p>
    <div id='content'>#{= T(meta.DC_description) }</div>
    <h3>Podcast</h3>
    <p class="podcasts">#{
local start = true
local is_ad_hoc = false
for _,podcast_name in ipairs(broadcast:podcast_names()) do 
    if podcast_name == 'ad_hoc' then is_ad_hoc = true end
    if not start then },#{ end
    start = false }
        <a href="../../../../../podcasts/#{= podcast_name }.rss"><img alt="RSS Icon" src="http://feedvalidator.org/images/valid-rss-rogers.png"/>#{= podcast_name }</a>#{
end }#{ 
if start then
    }keiner#{
end
 }    </p>
#{
if not broadcast:is_past() then
    if table.getn(broadcast:podcast_names()) == 0 then
        }<form method="post" action="../../../../../enclosures/app/ad_hoc.lua"><fieldset><input type="hidden" name="add" value="referer"/><input type="submit" value="Aufnehmen"/></fieldset></form>#{ 
    elseif is_ad_hoc then
        }<form method="post" action="../../../../../enclosures/app/ad_hoc.lua"><fieldset><input type="hidden" name="remove" value="referer"/><input type="submit" value="Nicht Aufnehmen"/></fieldset></form>#{ 
    end
end }
    <p id='footer'>
      <a href='http://validator.w3.org/check?uri=referer'>
        <img alt='Valid XHTML 1.0 Strict' height='31' src='http://www.w3.org/Icons/valid-xhtml10-blue.png' width='88'/>
      </a>
      <a href='http://jigsaw.w3.org/css-validator/check/referer?profile=css3&amp;usermedium=screen&amp;warning=2&amp;vextwarning=false&amp;lang=de'>
        <img alt='CSS ist valide!' src='http://jigsaw.w3.org/css-validator/images/vcss-blue' style='border:0;width:88px;height:31px'/>
      </a>
    </p>
  </body>
</html>
